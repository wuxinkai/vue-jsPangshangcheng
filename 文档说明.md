# 初始化

全局安装 vue-cli，在终端里输入

```
npm install vue-cli -g
```

用 webpack 初始化

```
  vue init webpack
```

![avatar](\clipboard.png)

# 安装 Vant 轻量、可靠的移动端 Vue 组件库

## 全局加载 vant

```
npm install vant -S
```

在 main.js 中全局引入插件

```
import vant from 'vant'
import 'vant/lib/index.css'
Vue.use(vant)
```

## 局部加载 vant 的某些组件

1. 加载插件

```
npm install babel-plugin-import -D
```

2. 在.babelrc 中设置,局部引入

```
 "plugins": [
    "transform-vue-jsx",
    "transform-runtime",
    ["import", {
      "libraryName": "vant",
      "styleLibraryName": "true"
    }]
  ]
```

3. 按需使用 Vant 组件

```
import { Button } from 'vant'
Vue.use(Button)
```

# 移动端屏幕适配基础

- index 页面内容

```
//得到手机屏幕的宽度
let htmlWidth = document.documentElement.clientWidth || document.body.clientWidth;

//设置最大宽度
if(htmlWidth>750){htmlWidth=750}

//得到html的Dom元素
let htmlDom = document.getElementsByTagName('html')[0];

//设置根元素字体大小
//iphone5  320/20 =16
htmlDom.style.fontSize= htmlWidth/20 + 'px';
```

- 设置标头

```
<meta name="viewport" content="width=device-width,initial-scale=1.0 ,user-scalable=no ">
```

# 图片懒加载

```
import { Swipe , SwipeItem , Lazyload  } from 'vant'
Vue.use(Swipe).use(SwipeItem).use(Lazyload)

<div class="swiper-area">
    <van-swipe :autoplay="1000">
        <van-swipe-item v-for="(banner,index) in bannerPicArray" :key="index">
            <img v-lazy="banner.imageUrl" width="100%"/>
        </van-swipe-item>
    </van-swipe>
</div>
```

# easyMock 和 Axios 的使用

### 下载

```
npm install --save axios
```

在页面引入

```
import axios from 'axios'
```

页面 get 请求

```
axios({
    url: 'https://www.easy-mock.com/mock/5c7006fba0b64b7d17824c17/SmileVue/index',
    method: 'get',
  }).then(response => {
    this.category=response.data.data.category;
  }).catch((error) => {})
}
```

# 商品推荐 vue-awesome-swiper 横向滑动效果

```
 npm install vue-awesome-swiper --save
```

在 main.js 全局引入

```
import Vue from 'vue'
import VueAwesomeSwiper from 'vue-awesome-swiper'
import 'swiper/dist/css/swiper.css'
Vue.use(VueAwesomeSwiper, /* { default global options } */)
```

局部引用 在当前页面 ShoppingMall
http://idangero.us/swiper/api/

```
import 'swiper/dist/css/swiper.css'
import { swiper, swiperSlide } from 'vue-awesome-swiper'
export default {
  data(){
    return:{
     swiperOption: {
        loop:true, //无线循环 滚动
        slidesPerView: 3, //页面视觉呈现多少个
        direction: 'vertical', //设置竖排显示
        // slidesPerView: 'auto', // 设置同屏显示的数量，默认为1，这里使用auto是随意的意思。
        // freeMode: true, //普通模式：slide滑动时只滑动一格，并自动贴合wrapper，设置为true则变为free模式，slide会根据惯性滑动可能不止一格且不会贴合。
        // mousewheel: true, //开启鼠标滚轮控制Swiper切换。可设置鼠标选项，或true使用默认值。
        pagination: {
          el: '.swiper-pagination',
          clickable: true
        }
      }
    }
  }
  components: {
    swiper,
    swiperSlide
  }
}
```

swiper 的 html 内容

```
<swiper :options="swiperOption">
  <swiper-slide v-for=" (item ,index) in recommendGoods" :key="index">
    <div class="recommend-item">
      <img :src="item.image" width="80%" />
      <div>{{item.goodsName}}</div>
      <div>￥{{item.price}} (￥{{item.mallPrice}})</div>
    </div>
  </swiper-slide>
</swiper>
```

# 用 watch 方法解决 父页面数据请求延时报错问题

父页面

```
<floor-component :floorData="floor1"></floor-component>
```

子页面

```
 export default {
      //接收 楼层数据
        props:['floorData'],
        data() {
            return {
                floorData0:{},
                floorData1:{},
                floorData2:{}
            }
        },
        created(){
            //这里写得不到数据，应为数据是延迟返回的
        },
        watch:{// 监视的数据floorData  只要发生变化
            floorData:function(val){
                console.log(this.floorData)
                this.floorData0=this.floorData[0]
                this.floorData1=this.floorData[1]
                this.floorData2=this.floorData[2]
            }
        }
    }
```

# 相同内容封装成组件

```
floorComponent.vue中
```

# Filter 在实战中的使用

- 父页面

```
 import { toMoney } from '@/filter/moneyFilter.js'

 <div>￥{{item.price | moneyFilter}} (￥{{item.mallPrice|moneyFilter}})</div>

 filters: {
    //moneyFilter自己写一个方法
    moneyFilter(money) {
      return toMoney(money)
    }
  },
```

- moneyFilter.js 页面

```
export function toMoney(money = 0){
  return money.toFixed(2)
}

```

# 编写后台服务接口配置文件

```
const BASEURL = "https://www.easy-mock.com/mock/5c7006fba0b64b7d17824c17/SmileVue/"
const URL = {
    getShoppingMallInfo:BASEURL+'index',
    getGoodsInfo:BASEURL+'getGoodsInfo'
}
module.exports = URL
```

应用

```
import url from '@/serviceAPI.config.js'
axios({
    url: url.getShoppingMallInfo,
    method: 'get',
})
```

# 遇到的问题

1. 屏幕适配，和 meta 适配
2. 轮播图清楚左侧有空隙，图片懒加载
3. Chrome 调试技巧 模拟慢速 3G 网络
4. css3 横向布局
5. swiper 的学习 ,添加分页器 ,竖屏切换效果,区域滚动效果，分页自由选择，无线循环滚动
6. （不规则的布局）页面加载子组件请求父页面内容，axios 还没请求到，子页面报错，用 watch 方法解决，
7. （不规则的布局） 相同内容封装成组件。
8. 循环传给子组件值
9. 编写后台服务接口配置文件

# 后台

安装 Koa2 到项目中来 ，在 service 文件夹下

```
npm install --save koa
```

index.js 内容

```
const Koa = require('koa')
const app = new Koa()
app.use(async(ctx)=>{
    ctx.body = '<h1>hello Koa2</h1>'
})
app.listen(3000,()=>{
    console.log('[Server] starting at port 3000')
})
```

启动

```
node index.js
```
# 数据库的操作流程
## 安装 MongoDB 数据库

```
mongod:在命令中直接输入mongod
```

## Mongoose 的安装

```
npm install mongoose --save
```

在 /service/database/init.js 的内容

```
const mongoose = require('mongoose')
const db = "mongodb://localhost/smile-db"
exports.connect = ()=>{
    //连接数据库
    mongoose.connect(db)
    let maxConnectTimes = 0
    return  new Promise((resolve,reject)=>{
    //把所有连接放到这里
        //增加数据库监听事件
        mongoose.connection.on('disconnected',()=>{
            console.log('***********数据库断开***********')
            if(maxConnectTimes<3){
                maxConnectTimes++
                mongoose.connect(db)
            }else{
                reject()
                throw new Error('数据库出现问题，程序无法搞定，请人为修理......')
            }
        })
        mongoose.connection.on('error',err=>{
            console.log('***********数据库错误***********')
            if(maxConnectTimes<3){
                maxConnectTimes++
                mongoose.connect(db)
            }else{
                reject(err)
                throw new Error('数据库出现问题，程序无法搞定，请人为修理......')
            }
        })
        //链接打开的时
        mongoose.connection.once('open',()=>{
            console.log('MongoDB connected successfully')
            resolve()
        })
    })
}
```

## Schema

- schema ：用来定义表的模版，实现和 MongoDB 数据库的映射。用来实现每个字段的类型，长度，映射的字段，不具备表的操作能力。
- model ：具备某张表操作能力的一个集合，是 mongoose 的核心能力。我们说的模型就是这个 Mondel。
- entity ：类似记录，由 Model 创建的实体，也具有影响数据库的操作能力。

### 数据类型

- String ：字符串类型
- Number ：数字类型
- Date ： 日期类型
- Boolean： 布尔类型
- Buffer ： NodeJS buffer 类型
- ObjectID ： 主键,一种特殊而且非常重要的类型
- Mixed ：混合类型
- Array ：集合类型

### User.js 的名字要和表的名字一样
```
const mongoose = require('mongoose')    //引入Mongoose
const Schema = mongoose.Schema          //声明Schema
let ObjectId = Schema.Types.ObjectId    //声明Object类型

//创建我们的用户Schema
const userSchema = new Schema({
    UserId:ObjectId,
    userName:{unique:true,type:String},
    password:String,
    createAt:{type:Date,default:Date.now()},
    lastLoginAt:{type:Date,default:Date.now()}
})

//发布模型 User必须和数据库的名字对应起来
mongoose.model('User',userSchema)
```
## 载入Schema和插入查出数据
- glob：node的glob模块允许你使用 * 等符号，来写一个glob规则，像在shell里一样，获取匹配对应规则文件。
- resolve: 将一系列路径或路径段解析为绝对路径。

```
npm install glob --save
```
在init.js引入
```
const glob = require('glob')
const {resolve} = require('path')

//把schema文件夹下所有的文件都引入的这里面， 利用通配符
exports.initSchemas = () =>{
    glob.sync(resolve(__dirname,'./schema/','**/*.js')).forEach(require)
}
```
## 操作数据库 在index.js中
```
const mongoose = require('mongoose')
const {connect , initSchemas} = require('./database/init.js')

//插入username 
;(async () =>{
    await connect()
    initSchemas()
    const User = mongoose.model('User')
    let oneUser = new User({userName:'jspang',password:'123456'})
    oneUser.save().then(()=>{
        console.log('插入成功')
    })
})()
```

1. 安装koa 在service\index.js写koa的配置
2. 安装mongoDB 在/service/database/init.js 写mongoDB的配置
3. 下载界面化工具robo 3t的下载
4.  Schema字段格式配置 在service\database\schema\User.js 写数据库字段格式配置
5.  glob 在/service/database/init.js读取 所有schema文件夹下的内容
6.  写入数据量内容 在service\index.js 写入内容
7， 启动顺序，先启动数据库cmd后执行mongod 再执行node index.js 

![avatar](\static\images\mongose.png)